void rtc_isr(void) {
    UBaseType_t intstatus;
    BaseType_t woken = pdFALSE;

    ++rtc_isr_count;

    if (rtc_check_flag(RTC_OW)) {     // Tràn bộ đếm
        ++rtc_overflow_count;
        rtc_clear_flag(RTC_OW);
        if (!alarm)                   // Nếu không có alarm đang chờ, xóa ALR
            rtc_clear_flag(RTC_ALR);
    }

    if (rtc_check_flag(RTC_SEC)) {    // Tick 1 giây
        rtc_clear_flag(RTC_SEC);

        // Cập nhật thời gian trong critical section
        intstatus = taskENTER_CRITICAL_FROM_ISR();
        if (++seconds >= 60) { ++minutes; seconds -= 60; }
        if (minutes >= 60)   { ++hours;   minutes -= 60; }
        if (hours >= 24)     { ++days;    hours   -= 24; }
        taskEXIT_CRITICAL_FROM_ISR(intstatus);

        // Đánh thức task2
        vTaskNotifyGiveFromISR(h_task2, &woken);
        portYIELD_FROM_ISR(woken);
        return;
    }

    if (rtc_check_flag(RTC_ALR)) {    // Báo thức
        ++rtc_alarm_count;
        rtc_clear_flag(RTC_ALR);

        // Đánh thức task3
        vTaskNotifyGiveFromISR(h_task3, &woken);
        portYIELD_FROM_ISR(woken);
        return;
    }
}
